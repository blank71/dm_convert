{%- import 'macros.jinja' as macros %}
apiVersion: compute.cnrm.cloud.google.com/v1beta1
kind: ComputeTargetPool
metadata:
{%- set properties = resource.get('properties', {}) %}
{{- macros.fields(properties, {'labels': 'labels'}, ' ' * 2) }}
{%- if 'name' in properties %}
  name: {{ properties['name'] | arbitrary_reference }}
{%- else %}
  name: {{ resource['name'] | arbitrary_reference }}
{%- endif %}
{%- if properties | set_difference(['name', 'labels', 'project']) %}
{# At least one field of properties was not converted to metadata and will be converted to spec. #}
spec:
  {{- macros.fields(properties, {
    'backupPool': 'backupTargetPoolRef',
    'description': 'description',
    'failoverRatio': 'failoverRatio',
    'region': 'region',
    'sessionAffinity': 'sessionAffinity',
  }, ' ' * 2) }}
  {%- if 'instances' in properties %}
  instances:
    {%- for instance in properties['instances'] %}
  - {{ instance | typed_reference }}
    {%- endfor %}
  {%- endif %}
  {%- if 'healthChecks' in properties %}
  healthChecks:
    {%- for healthCheck in properties['healthChecks'] %}
  - {{ healthCheck | reference_type }}: {{ healthCheck | typed_reference }}
    {%- endfor %}
  {%- endif %}
{%- endif %}
