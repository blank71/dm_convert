apiVersion: sql.cnrm.cloud.google.com/v1beta1
kind: SQLUser
metadata:
{%- if resource['properties']['project'] is defined %}
  annotations:
    cnrm.cloud.google.com/project-id: {{ resource['properties']['project'] }}
{%- endif %}
{%- if resource['properties']['labels'] is defined %}
  labels: {{ resource['properties']['labels'] }}
{%- endif %}
{%- if resource['properties']['name'] is defined %}
  name: {{ resource['properties']['name'] }}
{%- else %}
  name: {{ resource['name'] }}
{%- endif %}
spec:
{%- if resource['properties']['host'] is defined %}
  host: '{{ resource['properties']['host'] }}'
{%- endif %}
{%- if resource['properties']['instance'] is defined %}
  instanceRef:
    name: {{ resource['properties']['instance'].split('/')[-1] }}
{%- endif %}
{%- if resource['properties']['password'] is defined %}
  password:
    value: {{ resource['properties']['password'] }}
{%- endif %}
# DM fields not present in KCC:
# sqlserverUserDetails
