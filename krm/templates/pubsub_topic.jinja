{%- import 'macros.jinja' as macros %}
apiVersion: pubsub.cnrm.cloud.google.com/v1beta1
kind: PubSubTopic
metadata:
{%- set properties = resource.get('properties', {}) %}
{%- if 'project' in properties %}
  annotations:
    cnrm.cloud.google.com/project-id: {{ properties['project'] | arbitrary_reference }}
{%- endif %}
{{- macros.fields(properties, {'labels': 'labels'}, ' ' * 2) }}
  name: {{ resource['name'] }}
{%- set property_fields = {
    'kmsKeyName': 'kmsKeyRef',
    'messageStoragePolicy': 'messageStoragePolicy',
    'topic': 'resourceID',
} %}
{%- if properties | set_intersection(property_fields) %}
spec:
  {{- macros.fields(properties, property_fields, ' ' * 2) }}
{%- endif %}
