{%- import 'macros.jinja' as macros %}
apiVersion: compute.cnrm.cloud.google.com/v1beta1
kind: ComputeFirewall
metadata:
{%- set properties = resource.get('properties', {}) %}
{{- macros.fields(properties, {'labels': 'labels'}, ' ' * 2) }}
{%- if 'name' in properties %}
  name: {{ properties['name'] | arbitrary_reference }}
{%- else %}
  name: {{ resource['name'] | arbitrary_reference }}
{%- endif %}
{%- if properties | set_difference(['name', 'labels', 'project']) %}
{# At least one field of properties was not converted to metadata and will be converted to spec. #}
spec:
  {{- macros.fields(properties, {
    'description': 'description',
    'destinationRanges': 'destinationRanges',
    'direction': 'direction',
    'disabled': 'disabled',
    'network': 'networkRef',
    'priority': 'priority',
    'sourceRanges': 'sourceRanges',
    'sourceTags': 'sourceTags',
    'targetTags': 'targetTags',
  }, ' ' * 2) }}
  {{- macros.lists(properties, {
    'allowed': {
      'list_name': 'allow',
      'IPProtocol': 'protocol',
      'ports': 'ports',
    },
    'denied': {
      'list_name': 'deny',
      'IPProtocol': 'protocol',
      'ports': 'ports',
    },
  }, ' ' * 2) }}
  {%- if 'logConfig' in properties %}
    {%- set log_config = properties['logConfig'] %}
    {%- if log_config.get('enable') %}
  logConfig:
      {{- macros.fields(log_config, {
        'metadata': 'metadata',
      }, ' ' * 4) }}
    {%- endif %}
  {%- endif %}
{%- endif %}
